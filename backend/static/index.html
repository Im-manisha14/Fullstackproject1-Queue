<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            /* Professional Healthcare Color Palette */
            --primary-color: #1E88E5;        /* Medical Blue */
            --secondary-color: #26A69A;      /* Teal */
            --background-color: #F5F7FA;     /* Light Gray */
            --card-bg: #FFFFFF;              /* White */
            --success-color: #43A047;        /* Green */
            --warning-color: #FB8C00;        /* Orange */
            --danger-color: #E53935;         /* Red */
            --text-main: #263238;            /* Dark Gray */
            --text-muted: #607D8B;           /* Medium Gray */
            --text-light: #90A4AE;           /* Light Gray Text */
            --border-color: #E1E5E9;         /* Border */
            --hover-bg: #F8F9FA;             /* Hover Background */
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --transition-smooth: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--background-color);
            color: var(--text-main);
            min-height: 100vh;
            margin: 0;
            line-height: 1.6;
        }

        /* Professional Login Design */
        .login-container {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .auth-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }

        /* Professional Dashboard Header */
        .dashboard-header {
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-header h1 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
        }

        .user-details {
            text-align: right;
            font-size: 0.875rem;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .user-role {
            opacity: 0.8;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Professional Dashboard Layout */
        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background: var(--background-color);
            min-height: calc(100vh - 80px);
        }

        /* Role-Specific Styling */
        .patient-dashboard .dashboard-header {
            background: var(--primary-color);
        }

        .doctor-dashboard .dashboard-header {
            background: var(--text-main);
        }

        .pharmacy-dashboard .dashboard-header {
            background: var(--secondary-color);
        }

        /* Professional Cards */
        .card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .card h3 {
            margin: 0 0 1rem 0;
            color: var(--text-main);
            font-size: 1.125rem;
            font-weight: 600;
        }

        /* Professional Buttons */
        .btn {
            border: none;
            border-radius: 6px;
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            text-transform: none;
            letter-spacing: 0;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #1976D2;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--text-muted);
            color: white;
        }

        .btn-secondary:hover {
            background: #546E7A;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #388E3C;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #F57C00;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #D32F2F;
        }

        /* Professional Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: var(--text-main);
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.875rem;
            background: var(--card-bg);
            color: var(--text-main);
            transition: var(--transition-smooth);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }

        /* Status Indicators */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-booked {
            background: rgba(30, 136, 229, 0.1);
            color: var(--primary-color);
        }

        .status-completed {
            background: rgba(67, 160, 71, 0.1);
            color: var(--success-color);
        }

        .status-pending {
            background: rgba(251, 140, 0, 0.1);
            color: var(--warning-color);
        }

        .status-dispensed {
            background: rgba(67, 160, 71, 0.1);
            color: var(--success-color);
        }

        /* Queue Token */
        .queue-token {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
            background: rgba(30, 136, 229, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            display: inline-block;
        }

        /* Professional Tables */
        .table-container {
            overflow-x: auto;
            margin-top: 1rem;
        }

        .professional-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
        }

        .professional-table th {
            background: var(--background-color);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-main);
            border-bottom: 2px solid var(--border-color);
        }

        .professional-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-main);
        }

        .professional-table tr:hover {
            background: var(--hover-bg);
        }

        /* Responsive Grid */
        .dashboard-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: 1fr;
        }

        @media (min-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 2fr 1fr;
            }
            
            .doctor-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .pharmacy-grid {
                grid-template-columns: 2fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .auth-card {
                flex-direction: column;
                max-width: 400px;
                min-height: 0;
            }

            .auth-card-visual {
                display: none;
            }

            /* Hide visual on mobile for simple login */
            .auth-card-form {
                width: 100%;
                padding: 2rem;
            }
        }

        /* Loading Spinner Color */
        .loading-spinner {
            border-top-color: var(--primary-color);
        }

        /* Complete Login Form Styling */
        .login-container {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .auth-card {
            background: white;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }

        .auth-header {
            text-align: center;
            padding: 2rem 2rem 1rem;
            border-bottom: 2px solid var(--bg-neutral);
        }

        .auth-logo {
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 1.5rem;
        }

        .auth-header h2 {
            color: var(--primary-dark);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .auth-header p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .auth-card form {
            padding: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: var(--text-main);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .input-icon-wrapper {
            position: relative;
        }

        .input-icon-wrapper i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            z-index: 1;
        }

        .input-icon-wrapper input,
        .input-icon-wrapper select {
            padding-left: 3rem;
        }

        .btn {
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            border: none;
            cursor: pointer;
            transition: var(--transition-smooth);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-secondary {
            background: var(--bg-neutral);
            color: var(--text-main);
        }

        .btn-secondary:hover {
            background: var(--text-muted);
            color: white;
        }

        .error {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #ef4444;
            background: #fef2f2;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.9rem;
            margin: 0 2rem 1rem;
            border: 1px solid #fee2e2;
        }

        .success {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent-green);
            background: #d1fae5;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.9rem;
            margin: 0 2rem 1rem;
            border: 1px solid #a7f3d0;
        }

        .auth-footer {
            text-align: center;
            padding: 1rem 2rem 2rem;
            border-top: 1px solid var(--bg-neutral);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .auth-link {
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition-smooth);
        }

        .auth-link:hover {
            color: var(--primary-dark);
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: var(--transition-smooth);
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Dashboard Styling */
        .dashboard {
            padding: 2rem;
            background: var(--bg-neutral);
            min-height: calc(100vh - 80px);
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1rem;
        }

        .grid {
            gap: 2rem;
        }

    </style>
</head>

<body>
    <div id="root">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Starting Healthcare System...</p>
        </div>
    </div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script>
        const { useState, useEffect, useMemo } = React;
        const { createRoot } = ReactDOM;

        const API_BASE_URL = 'http://localhost:5000/api';

        // --- COMPONENTS ---

        const Nav = ({ user, onLogout }) => (
            React.createElement('div', { className: `dashboard-header ${user.role}-dashboard` },
                React.createElement('div', { className: 'header-logo' },
                    React.createElement('div', { className: 'logo-icon' },
                        React.createElement('i', { className: 'fas fa-hospital-user' })
                    ),
                    React.createElement('h1', null, 
                        user.role === 'patient' ? 'Patient Portal' :
                        user.role === 'doctor' ? 'Doctor Dashboard' :
                        user.role === 'pharmacy' ? 'Pharmacy Management' :
                        'Healthcare System'
                    )
                ),
                React.createElement('div', { className: 'user-info' },
                    React.createElement('div', { className: 'user-details' },
                        React.createElement('div', { className: 'user-name' }, user.full_name),
                        React.createElement('div', { className: 'user-role' }, user.role)
                    ),
                    React.createElement('button', {
                        onClick: onLogout,
                        className: 'btn btn-danger',
                        style: { padding: '0.5rem 1rem', fontSize: '0.75rem' }
                    }, 'Logout')
                )
            )
        );

        const PatientDashboard = ({ user, onLogout }) => {
            const [doctors, setDoctors] = useState([]);
            const [appointments, setAppointments] = useState([]);
            const [prescriptions, setPrescriptions] = useState([]);
            const [loading, setLoading] = useState(true);
            const [bookingDoc, setBookingDoc] = useState(null);
            const [symptoms, setSymptoms] = useState('');

            const fetchData = async () => {
                const token = localStorage.getItem('auth_token');
                const headers = { 'Authorization': `Bearer ${token}` };
                try {
                    const [docsRes, aptsRes, pxRes] = await Promise.all([
                        fetch(`${API_BASE_URL}/doctors`, { headers }),
                        fetch(`${API_BASE_URL}/patient/appointments`, { headers }),
                        fetch(`${API_BASE_URL}/patient/prescriptions`, { headers })
                    ]);
                    if (docsRes.status === 401 || docsRes.status === 422) {
                        onLogout();
                        return;
                    }
                    const [docsData, aptsData, pxData] = await Promise.all([
                        docsRes.json(), aptsRes.json(), pxRes.json()
                    ]);
                    setDoctors(Array.isArray(docsData.doctors) ? docsData.doctors : []);
                    setAppointments(Array.isArray(aptsData) ? aptsData : []);
                    setPrescriptions(Array.isArray(pxData) ? pxData : []);
                } catch (e) {
                    console.error('Error:', e);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => { fetchData(); }, []);

            const handleBook = async (e) => {
                e.preventDefault();
                const token = localStorage.getItem('auth_token');
                try {
                    const res = await fetch(`${API_BASE_URL}/appointments`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            doctor_id: bookingDoc.id,
                            appointment_date: new Date().toISOString().split('T')[0],
                            appointment_time: '10:00',
                            symptoms
                        })
                    });
                    if (res.ok) {
                        setBookingDoc(null);
                        setSymptoms('');
                        fetchData();
                    }
                } catch (e) { console.error(e); }
            };

            if (loading) return React.createElement('div', { className: 'dashboard' }, 
                React.createElement('p', { style: { textAlign: 'center', padding: '2rem' } }, 'Loading your information...')
            );

            return React.createElement('div', { className: 'dashboard patient-dashboard' },
                React.createElement('div', { className: 'dashboard-grid' },
                    // Main Content
                    React.createElement('div', null,
                        // Book Appointment Card
                        React.createElement('div', { className: 'card' },
                            React.createElement('h3', null, 'Book New Appointment'),
                            React.createElement('p', { style: { color: 'var(--text-muted)', marginBottom: '1.5rem' } }, 
                                'Schedule your appointment with our healthcare professionals'
                            ),
                            React.createElement('div', { style: { display: 'grid', gap: '1rem' } },
                                doctors.slice(0, 3).map(doc => React.createElement('div', {
                                    key: doc.id,
                                    style: { 
                                        padding: '1rem', 
                                        border: '1px solid var(--border-color)', 
                                        borderRadius: '6px',
                                        display: 'flex', 
                                        justifyContent: 'space-between', 
                                        alignItems: 'center',
                                        background: 'var(--hover-bg)'
                                    }
                                },
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { fontWeight: '600', marginBottom: '4px' } }, `Dr. ${doc.name}`),
                                        React.createElement('div', { style: { fontSize: '0.875rem', color: 'var(--text-muted)' } }, 
                                            `${doc.specialization} - ${doc.department}`
                                        )
                                    ),
                                    React.createElement('button', {
                                        className: 'btn btn-primary',
                                        onClick: () => setBookingDoc(doc)
                                    }, 'Book Appointment')
                                ))
                            )
                        ),
                        
                        // My Appointments
                        React.createElement('div', { className: 'card' },
                            React.createElement('h3', null, 'Your Appointments'),
                            appointments.length === 0 ? 
                                React.createElement('p', { style: { color: 'var(--text-muted)', textAlign: 'center', padding: '2rem' } }, 
                                    'No appointments scheduled'
                                ) :
                                React.createElement('div', { className: 'table-container' },
                                    React.createElement('table', { className: 'professional-table' },
                                        React.createElement('thead', null,
                                            React.createElement('tr', null,
                                                React.createElement('th', null, 'Doctor'),
                                                React.createElement('th', null, 'Date & Time'),
                                                React.createElement('th', null, 'Token'),
                                                React.createElement('th', null, 'Status')
                                            )
                                        ),
                                        React.createElement('tbody', null,
                                            appointments.map(apt => React.createElement('tr', { key: apt.id },
                                                React.createElement('td', null, apt.doctor_name),
                                                React.createElement('td', null, `${apt.appointment_date} at ${apt.appointment_time}`),
                                                React.createElement('td', null, 
                                                    React.createElement('span', { className: 'queue-token' }, `#${apt.token_number}`)
                                                ),
                                                React.createElement('td', null,
                                                    React.createElement('span', { 
                                                        className: `status-badge status-${apt.status}` 
                                                    }, apt.status)
                                                )
                                            ))
                                        )
                                    )
                                )
                        )
                    ),
                    
                    // Sidebar
                    React.createElement('div', null,
                        React.createElement('div', { className: 'card' },
                            React.createElement('h3', null, 'Your Prescriptions'),
                            prescriptions.length === 0 ? 
                                React.createElement('p', { style: { color: 'var(--text-muted)', textAlign: 'center', padding: '1rem' } }, 
                                    'No prescriptions available'
                                ) :
                                prescriptions.slice(0, 5).map(px => React.createElement('div', {
                                    key: px.id,
                                    style: { 
                                        padding: '1rem 0', 
                                        borderBottom: '1px solid var(--border-color)',
                                        '&:lastChild': { borderBottom: 'none' }
                                    }
                                },
                                    React.createElement('div', { style: { fontWeight: '600', marginBottom: '4px' } }, px.doctor_name),
                                    React.createElement('div', { style: { fontSize: '0.75rem', color: 'var(--text-muted)', marginBottom: '8px' } }, px.created_at),
                                    React.createElement('div', { style: { fontSize: '0.875rem' } },
                                        Array.isArray(px.medicines) ? px.medicines.map(m => m.name).join(', ') : 'View prescription details'
                                    )
                                ))
                        )
                    )
                ),
                
                // Booking Modal
                bookingDoc && React.createElement('div', {
                    style: { 
                        position: 'fixed', 
                        top: 0, 
                        left: 0, 
                        right: 0, 
                        bottom: 0, 
                        background: 'rgba(0,0,0,0.5)', 
                        display: 'flex', 
                        alignItems: 'center', 
                        justifyContent: 'center', 
                        zIndex: 1000,
                        padding: '1rem'
                    }
                },
                    React.createElement('div', { 
                        className: 'card', 
                        style: { 
                            width: '100%', 
                            maxWidth: '400px',
                            margin: 0
                        } 
                    },
                        React.createElement('h3', { style: { marginBottom: '1.5rem' } }, `Book with Dr. ${bookingDoc.name}`),
                        React.createElement('form', { onSubmit: handleBook },
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'Describe your symptoms'),
                                React.createElement('textarea', {
                                    placeholder: 'Please describe your symptoms or reason for visit...',
                                    value: symptoms,
                                    onChange: e => setSymptoms(e.target.value),
                                    required: true,
                                    rows: 3
                                })
                            ),
                            React.createElement('div', { style: { display: 'flex', gap: '1rem', justifyContent: 'flex-end' } },
                                React.createElement('button', {
                                    type: 'button',
                                    className: 'btn btn-secondary',
                                    onClick: () => setBookingDoc(null)
                                }, 'Cancel'),
                                React.createElement('button', { 
                                    type: 'submit', 
                                    className: 'btn btn-primary' 
                                }, 'Confirm Booking')
                            )
                        )
                    )
                )
            );
        };

        const DoctorDashboard = ({ user }) => {
            const [appointments, setAppointments] = useState([]);
            const [loading, setLoading] = useState(true);
            const [consulting, setConsulting] = useState(null);
            const [diagnosis, setDiagnosis] = useState('');
            const [meds, setMeds] = useState('');

            const fetchData = async () => {
                const token = localStorage.getItem('auth_token');
                try {
                    const res = await fetch(`${API_BASE_URL}/doctor/appointments?status=booked`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    const data = await res.json();
                    setAppointments(data || []);
                } catch (e) { console.error(e); } finally { setLoading(false); }
            };

            useEffect(() => { fetchData(); }, []);

            const handleComplete = async (e) => {
                e.preventDefault();
                const token = localStorage.getItem('auth_token');
                try {
                    await fetch(`${API_BASE_URL}/prescriptions`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            appointment_id: consulting.id,
                            medicines: meds.split(',').map(m => ({ name: m.trim() })),
                            notes: diagnosis
                        })
                    });
                    await fetch(`${API_BASE_URL}/appointments/${consulting.id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({ status: 'completed' })
                    });
                    setConsulting(null);
                    setDiagnosis('');
                    setMeds('');
                    fetchData();
                } catch (e) { console.error(e); }
            };

            if (loading) return React.createElement('div', { className: 'dashboard' },
                React.createElement('p', { style: { textAlign: 'center', padding: '2rem' } }, 'Loading appointment queue...')
            );

            return React.createElement('div', { className: 'dashboard doctor-dashboard' },
                React.createElement('div', { className: 'dashboard-grid doctor-grid' },
                    // Queue Management
                    React.createElement('div', null,
                        React.createElement('div', { className: 'card' },
                            React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' } },
                                React.createElement('h3', { style: { margin: 0 } }, 'Patient Queue'),
                                React.createElement('div', { 
                                    style: { 
                                        background: 'var(--primary-color)', 
                                        color: 'white', 
                                        padding: '0.5rem 1rem', 
                                        borderRadius: '20px', 
                                        fontSize: '0.875rem',
                                        fontWeight: '600'
                                    } 
                                }, `${appointments.length} Patients`)
                            ),
                            appointments.length === 0 ? 
                                React.createElement('div', { 
                                    style: { 
                                        textAlign: 'center', 
                                        padding: '3rem', 
                                        color: 'var(--text-muted)' 
                                    } 
                                },
                                    React.createElement('i', { 
                                        className: 'fas fa-clipboard-check', 
                                        style: { fontSize: '3rem', marginBottom: '1rem', opacity: 0.3 } 
                                    }),
                                    React.createElement('p', null, 'No patients in queue today')
                                ) :
                                React.createElement('div', { className: 'table-container' },
                                    React.createElement('table', { className: 'professional-table' },
                                        React.createElement('thead', null,
                                            React.createElement('tr', null,
                                                React.createElement('th', null, 'Token'),
                                                React.createElement('th', null, 'Patient'),
                                                React.createElement('th', null, 'Symptoms'),
                                                React.createElement('th', null, 'Time'),
                                                React.createElement('th', null, 'Action')
                                            )
                                        ),
                                        React.createElement('tbody', null,
                                            appointments.map((apt, index) => React.createElement('tr', { 
                                                key: apt.id,
                                                style: index === 0 ? { background: 'rgba(67, 160, 71, 0.05)' } : {}
                                            },
                                                React.createElement('td', null,
                                                    React.createElement('span', { 
                                                        className: 'queue-token',
                                                        style: index === 0 ? { background: 'var(--success-color)', color: 'white' } : {}
                                                    }, `#${apt.token_number}`)
                                                ),
                                                React.createElement('td', null,
                                                    React.createElement('div', { style: { fontWeight: '600' } }, apt.patient_name),
                                                    index === 0 && React.createElement('div', { 
                                                        style: { 
                                                            fontSize: '0.75rem', 
                                                            color: 'var(--success-color)', 
                                                            fontWeight: '600',
                                                            textTransform: 'uppercase'
                                                        } 
                                                    }, 'NEXT PATIENT')
                                                ),
                                                React.createElement('td', null, 
                                                    React.createElement('div', { 
                                                        style: { 
                                                            maxWidth: '200px', 
                                                            overflow: 'hidden', 
                                                            textOverflow: 'ellipsis' 
                                                        } 
                                                    }, apt.symptoms)
                                                ),
                                                React.createElement('td', null, apt.appointment_time),
                                                React.createElement('td', null,
                                                    React.createElement('button', {
                                                        className: index === 0 ? 'btn btn-success' : 'btn btn-primary',
                                                        onClick: () => setConsulting(apt),
                                                        style: { fontSize: '0.8rem', padding: '0.5rem 1rem' }
                                                    }, index === 0 ? 'Start Consultation' : 'View Details')
                                                )
                                            ))
                                        )
                                    )
                                )
                        )
                    ),
                    
                    // Consultation Panel
                    React.createElement('div', null,
                        consulting ? React.createElement('div', { className: 'card' },
                            React.createElement('h3', { style: { marginBottom: '1.5rem' } }, 'Patient Consultation'),
                            React.createElement('div', { 
                                style: { 
                                    background: 'var(--hover-bg)', 
                                    padding: '1rem', 
                                    borderRadius: '6px', 
                                    marginBottom: '1.5rem' 
                                } 
                            },
                                React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' } },
                                    React.createElement('span', { style: { fontWeight: '600' } }, consulting.patient_name),
                                    React.createElement('span', { className: 'queue-token' }, `Token #${consulting.token_number}`)
                                ),
                                React.createElement('div', { style: { fontSize: '0.875rem', color: 'var(--text-muted)' } },
                                    React.createElement('strong', null, 'Symptoms: '), consulting.symptoms
                                )
                            ),
                            React.createElement('form', { onSubmit: handleComplete },
                                React.createElement('div', { className: 'form-group' },
                                    React.createElement('label', null, 'Diagnosis'),
                                    React.createElement('textarea', { 
                                        value: diagnosis, 
                                        onChange: e => setDiagnosis(e.target.value), 
                                        required: true,
                                        rows: 3,
                                        placeholder: 'Enter your medical diagnosis...'
                                    })
                                ),
                                React.createElement('div', { className: 'form-group' },
                                    React.createElement('label', null, 'Prescribed Medicines'),
                                    React.createElement('input', { 
                                        value: meds, 
                                        onChange: e => setMeds(e.target.value), 
                                        placeholder: 'Paracetamol 500mg, Amoxicillin 250mg', 
                                        required: true 
                                    }),
                                    React.createElement('div', { 
                                        style: { 
                                            fontSize: '0.75rem', 
                                            color: 'var(--text-muted)', 
                                            marginTop: '0.25rem' 
                                        } 
                                    }, 'Separate multiple medicines with commas')
                                ),
                                React.createElement('div', { style: { display: 'flex', gap: '1rem', justifyContent: 'flex-end' } },
                                    React.createElement('button', {
                                        type: 'button',
                                        className: 'btn btn-secondary',
                                        onClick: () => {
                                            setConsulting(null);
                                            setDiagnosis('');
                                            setMeds('');
                                        }
                                    }, 'Cancel'),
                                    React.createElement('button', { 
                                        type: 'submit', 
                                        className: 'btn btn-success' 
                                    }, 'Complete & Prescribe')
                                )
                            )
                        ) : React.createElement('div', { className: 'card' },
                            React.createElement('div', { 
                                style: { 
                                    textAlign: 'center', 
                                    padding: '3rem', 
                                    color: 'var(--text-muted)' 
                                } 
                            },
                                React.createElement('i', { 
                                    className: 'fas fa-user-doctor', 
                                    style: { fontSize: '3rem', marginBottom: '1rem', opacity: 0.3 } 
                                }),
                                React.createElement('h4', null, 'Ready for Consultation'),
                                React.createElement('p', null, 'Select a patient from the queue to begin consultation')
                            )
                        )
                    )
                )
            );
        };

        const PharmacyDashboard = ({ user }) => {
            const [prescriptions, setPrescriptions] = useState([]);
            const [inventory, setInventory] = useState([]);
            const [loading, setLoading] = useState(true);

            const fetchData = async () => {
                const token = localStorage.getItem('auth_token');
                const headers = { 'Authorization': `Bearer ${token}` };
                try {
                    const [pxRes, invRes] = await Promise.all([
                        fetch(`${API_BASE_URL}/pharmacy/prescriptions`, { headers }),
                        fetch(`${API_BASE_URL}/pharmacy/inventory`, { headers })
                    ]);
                    const [pxData, invData] = await Promise.all([pxRes.json(), invRes.json()]);
                    setPrescriptions(pxData || []);
                    setInventory(invData || []);
                } catch (e) { console.error(e); } finally { setLoading(false); }
            };

            useEffect(() => { fetchData(); }, []);

            const handleDispense = async (id) => {
                const token = localStorage.getItem('auth_token');
                try {
                    await fetch(`${API_BASE_URL}/pharmacy/prescriptions/${id}/status`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({ status: 'dispensed' })
                    });
                    fetchData();
                } catch (e) { console.error(e); }
            };

            if (loading) return React.createElement('div', { className: 'dashboard' },
                React.createElement('p', { style: { textAlign: 'center', padding: '2rem' } }, 'Loading pharmacy data...')
            );

            return React.createElement('div', { className: 'dashboard pharmacy-dashboard' },
                React.createElement('div', { className: 'dashboard-grid pharmacy-grid' },
                    // Prescription Management
                    React.createElement('div', null,
                        React.createElement('div', { className: 'card' },
                            React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' } },
                                React.createElement('h3', { style: { margin: 0 } }, 'Prescription Queue'),
                                React.createElement('div', { 
                                    style: { 
                                        background: 'var(--secondary-color)', 
                                        color: 'white', 
                                        padding: '0.5rem 1rem', 
                                        borderRadius: '20px', 
                                        fontSize: '0.875rem',
                                        fontWeight: '600'
                                    } 
                                }, `${prescriptions.length} Pending`)
                            ),
                            prescriptions.length === 0 ? 
                                React.createElement('div', { 
                                    style: { 
                                        textAlign: 'center', 
                                        padding: '3rem', 
                                        color: 'var(--text-muted)' 
                                    } 
                                },
                                    React.createElement('i', { 
                                        className: 'fas fa-prescription-bottle', 
                                        style: { fontSize: '3rem', marginBottom: '1rem', opacity: 0.3 } 
                                    }),
                                    React.createElement('p', null, 'No pending prescriptions')
                                ) :
                                React.createElement('div', { className: 'table-container' },
                                    React.createElement('table', { className: 'professional-table' },
                                        React.createElement('thead', null,
                                            React.createElement('tr', null,
                                                React.createElement('th', null, 'Token'),
                                                React.createElement('th', null, 'Patient'),
                                                React.createElement('th', null, 'Medicines'),
                                                React.createElement('th', null, 'Doctor'),
                                                React.createElement('th', null, 'Status'),
                                                React.createElement('th', null, 'Action')
                                            )
                                        ),
                                        React.createElement('tbody', null,
                                            prescriptions.map(px => React.createElement('tr', { key: px.id },
                                                React.createElement('td', null,
                                                    React.createElement('span', { className: 'queue-token' }, `#${px.id}`)
                                                ),
                                                React.createElement('td', null,
                                                    React.createElement('div', { style: { fontWeight: '600' } }, px.patient_name)
                                                ),
                                                React.createElement('td', null,
                                                    React.createElement('div', { 
                                                        style: { 
                                                            maxWidth: '250px',
                                                            fontSize: '0.875rem'
                                                        } 
                                                    }, px.medicines.map(m => m.name).join(', '))
                                                ),
                                                React.createElement('td', null, px.doctor_name || 'Not specified'),
                                                React.createElement('td', null,
                                                    React.createElement('span', { 
                                                        className: `status-badge status-${px.status || 'pending'}` 
                                                    }, px.status || 'pending')
                                                ),
                                                React.createElement('td', null,
                                                    React.createElement('button', {
                                                        className: 'btn btn-success',
                                                        onClick: () => handleDispense(px.id),
                                                        style: { fontSize: '0.8rem', padding: '0.5rem 1rem' }
                                                    }, 'Dispense')
                                                )
                                            ))
                                        )
                                    )
                                )
                        )
                    ),
                    
                    // Inventory Management
                    React.createElement('div', null,
                        React.createElement('div', { className: 'card' },
                            React.createElement('h3', { style: { marginBottom: '1.5rem' } }, 'Medicine Inventory'),
                            inventory.length === 0 ? 
                                React.createElement('div', { 
                                    style: { 
                                        textAlign: 'center', 
                                        padding: '2rem', 
                                        color: 'var(--text-muted)' 
                                    } 
                                },
                                    React.createElement('p', null, 'No inventory data available')
                                ) :
                                React.createElement('div', { style: { maxHeight: '500px', overflowY: 'auto' } },
                                    inventory.map(item => React.createElement('div', {
                                        key: item.id,
                                        style: { 
                                            display: 'flex', 
                                            justifyContent: 'space-between', 
                                            alignItems: 'center',
                                            padding: '0.75rem 0',
                                            borderBottom: '1px solid var(--border-color)'
                                        }
                                    },
                                        React.createElement('div', null,
                                            React.createElement('div', { style: { fontWeight: '600', marginBottom: '2px' } }, item.medicine_name),
                                            React.createElement('div', { 
                                                style: { 
                                                    fontSize: '0.75rem', 
                                                    color: 'var(--text-muted)' 
                                                } 
                                            }, `SKU: ${item.id}`)
                                        ),
                                        React.createElement('div', { style: { textAlign: 'right' } },
                                            React.createElement('div', { 
                                                style: { 
                                                    fontWeight: '600',
                                                    color: item.low_stock ? 'var(--danger-color)' : 
                                                           item.quantity_in_stock < 50 ? 'var(--warning-color)' : 
                                                           'var(--success-color)'
                                                } 
                                            }, `${item.quantity_in_stock} units`),
                                            item.low_stock && React.createElement('div', { 
                                                style: { 
                                                    fontSize: '0.75rem', 
                                                    color: 'var(--danger-color)',
                                                    fontWeight: '600'
                                                } 
                                            }, 'LOW STOCK')
                                        )
                                    ))
                                ),
                            
                            // Inventory Summary
                            inventory.length > 0 && React.createElement('div', { 
                                style: { 
                                    marginTop: '1.5rem', 
                                    padding: '1rem', 
                                    background: 'var(--hover-bg)', 
                                    borderRadius: '6px' 
                                } 
                            },
                                React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', fontSize: '0.875rem' } },
                                    React.createElement('span', null, 'Total Medicines:'),
                                    React.createElement('strong', null, inventory.length)
                                ),
                                React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', fontSize: '0.875rem', marginTop: '0.5rem' } },
                                    React.createElement('span', null, 'Low Stock Items:'),
                                    React.createElement('strong', { 
                                        style: { color: 'var(--danger-color)' } 
                                    }, inventory.filter(item => item.low_stock).length)
                                )
                            )
                        )
                    )
                )
            );
        };

        const LoginForm = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [fullName, setFullName] = useState('');
            const [role, setRole] = useState('patient');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [isRegistering, setIsRegistering] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                setSuccess('');
                try {
                    const endpoint = isRegistering ? '/auth/register' : '/auth/login';
                    const body = isRegistering ? { email, password, full_name: fullName, role } : { email, password };

                    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body),
                    });
                    const data = await response.json();

                    if (response.ok) {
                        if (isRegistering) {
                            setSuccess('Account created successfully! Please sign in.');
                            setIsRegistering(false);
                            setEmail(''); setPassword(''); setFullName('');
                        } else {
                            localStorage.setItem('auth_token', data.access_token);
                            localStorage.setItem('user', JSON.stringify(data.user));
                            onLogin(data.user);
                        }
                    } else {
                        setError(data.error || 'Operation failed. Please try again.');
                    }
                } catch (err) {
                    setError('Unable to connect to the healthcare server.');
                } finally {
                    setLoading(false);
                }
            };

            return React.createElement('div', { className: 'login-container' },
                React.createElement('div', { className: 'auth-card' },
                    React.createElement('div', { className: 'auth-header' },
                        React.createElement('div', { className: 'auth-logo' },
                            React.createElement('i', { className: 'fas fa-hospital-user' })
                        ),
                        React.createElement('h2', null, isRegistering ? 'Create Healthcare Account' : 'Healthcare Professional Access'),
                        React.createElement('p', null, isRegistering ? 'Join our healthcare network' : 'Secure access to your medical dashboard')
                    ),

                    error && React.createElement('div', { className: 'error' },
                        React.createElement('i', { className: 'fas fa-exclamation-triangle' }),
                        React.createElement('span', null, error)
                    ),
                    success && React.createElement('div', { className: 'success' },
                        React.createElement('i', { className: 'fas fa-check-circle' }),
                        React.createElement('span', null, success)
                    ),

                    React.createElement('form', { onSubmit: handleSubmit, autoComplete: 'off' },
                        isRegistering && React.createElement('div', { className: 'form-group' },
                            React.createElement('label', { htmlFor: 'reg_full_name' }, 'Full Name'),
                            React.createElement('input', {
                                id: 'reg_full_name',
                                name: 'reg_full_name',
                                autocomplete: 'new-name',
                                placeholder: 'Dr. Jane Smith',
                                value: fullName,
                                onChange: e => setFullName(e.target.value),
                                required: true
                            })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', { htmlFor: 'hms_primary_contact' }, 'Email Address'),
                            React.createElement('input', {
                                type: 'email',
                                id: 'hms_primary_contact',
                                name: 'hms_primary_contact',
                                autocomplete: 'off',
                                placeholder: 'name@healthcare.com',
                                value: email,
                                onChange: e => setEmail(e.target.value),
                                required: true
                            })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', { htmlFor: 'hms_secure_entry' }, 'Password'),
                            React.createElement('input', {
                                type: 'password',
                                id: 'hms_secure_entry',
                                name: 'hms_secure_entry',
                                autocomplete: 'off',
                                placeholder: 'Enter secure password',
                                value: password,
                                onChange: e => setPassword(e.target.value),
                                required: true
                            })
                        ),
                        isRegistering && React.createElement('div', { className: 'form-group' },
                            React.createElement('label', null, 'Professional Role'),
                            React.createElement('select', { value: role, onChange: e => setRole(e.target.value) },
                                React.createElement('option', { value: 'patient' }, 'Patient'),
                                React.createElement('option', { value: 'doctor' }, 'Medical Doctor'),
                                React.createElement('option', { value: 'pharmacy' }, 'Pharmacy Staff')
                            )
                        ),
                        React.createElement('button', { type: 'submit', className: 'btn btn-primary', disabled: loading, style: { width: '100%' } },
                            loading && React.createElement('i', { className: 'fas fa-spinner fa-spin', style: { marginRight: '0.5rem' } }),
                            loading ? 'Processing...' : (isRegistering ? 'Create Account' : 'Sign In')
                        )
                    ),
                    React.createElement('div', { className: 'auth-footer' },
                        React.createElement('span', null, isRegistering ? 'Already have an account? ' : 'Need an account? '),
                        React.createElement('span', {
                            className: 'auth-link',
                            onClick: () => {
                                setIsRegistering(!isRegistering);
                                setError('');
                                setSuccess('');
                            }
                        }, isRegistering ? 'Sign In' : 'Register Here')
                    )
                )
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const token = localStorage.getItem('auth_token');
                const userData = localStorage.getItem('user');
                if (token && userData) setUser(JSON.parse(userData));
                setLoading(false);
            }, []);

            if (loading) return null;

            if (!user) return React.createElement(LoginForm, { onLogin: setUser });

            return React.createElement('div', null,
                React.createElement(Nav, { user, onLogout: () => { localStorage.clear(); setUser(null); } }),
                user.role === 'patient' && React.createElement(PatientDashboard, { user, onLogout: () => { localStorage.clear(); setUser(null); } }),
                user.role === 'doctor' && React.createElement(DoctorDashboard, { user }),
                user.role === 'pharmacy' && React.createElement(PharmacyDashboard, { user }),
                user.role === 'admin' && React.createElement('div', { className: 'dashboard card' }, 'Admin features are in backend/admin API')
            );
        };

        createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
</body>

</html>