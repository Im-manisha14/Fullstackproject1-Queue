<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Management System</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f8f9fa;
            color: #333;
        }
        
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #f8f9fa;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e9ecef;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #f8f9fa;
            padding: 2rem;
        }
        
        .login-form {
            background: white;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .login-form h2 {
            margin-bottom: 2rem;
            text-align: center;
            color: #333;
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .btn {
            width: 100%;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid #dc3545;
        }
        
        .dashboard {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            padding: 0.75rem 1.5rem;
            width: auto;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Starting Healthcare System...</p>
        </div>
    </div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script>
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        const API_BASE_URL = 'http://localhost:5000/api';

        const LoginForm = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [fullName, setFullName] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [isRegistering, setIsRegistering] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');

                try {
                    const endpoint = isRegistering ? '/auth/register' : '/auth/login';
                    const body = isRegistering ? {
                        username: email.toLowerCase().trim().split('@')[0],
                        email: email.toLowerCase().trim(),
                        password: password,
                        full_name: fullName,
                        role: 'patient'
                    } : {
                        username: email.toLowerCase().trim(),
                        password: password
                    };

                    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body),
                    });

                    const data = await response.json();

                    if (response.ok && (data.success || data.message === 'User created successfully')) {
                        if (isRegistering) {
                            setError('Account created! Now you can login.');
                            setIsRegistering(false);
                        } else {
                            localStorage.setItem('auth_token', data.access_token);
                            localStorage.setItem('user', JSON.stringify(data.user));
                            onLogin(data.user);
                        }
                    } else {
                        setError(data.message || data.error || (isRegistering ? 'Registration failed' : 'Login failed'));
                    }
                } catch (err) {
                    setError('Cannot connect to server. Check if backend is running on port 5000.');
                } finally {
                    setLoading(false);
                }
            };

            return React.createElement('div', { className: 'login-container' },
                React.createElement('div', { className: 'login-form' },
                    React.createElement('h2', null, isRegistering ? 'ðŸ¥ Create Account' : 'ðŸ¥ Healthcare Login'),
                    error && React.createElement('div', { 
                        className: error.includes('created') ? 'success' : 'error' 
                    }, error),
                    React.createElement('form', { onSubmit: handleSubmit },
                        isRegistering && React.createElement('div', { className: 'form-group' },
                            React.createElement('input', {
                                type: 'text',
                                placeholder: 'Full Name',
                                value: fullName,
                                onChange: (e) => setFullName(e.target.value),
                                required: isRegistering,
                                disabled: loading
                            })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('input', {
                                type: 'email',
                                placeholder: 'Enter your email',
                                value: email,
                                onChange: (e) => setEmail(e.target.value),
                                required: true,
                                disabled: loading
                            })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('input', {
                                type: 'password',
                                placeholder: 'Enter your password',
                                value: password,
                                onChange: (e) => setPassword(e.target.value),
                                required: true,
                                disabled: loading
                            })
                        ),
                        React.createElement('button', {
                            type: 'submit',
                            disabled: loading,
                            className: 'btn btn-primary'
                        }, loading ? 
                            (isRegistering ? 'Creating Account...' : 'Signing in...') : 
                            (isRegistering ? 'Create Account' : 'Sign In')
                        )
                    ),
                    React.createElement('div', { 
                        style: { marginTop: '1rem', textAlign: 'center', cursor: 'pointer', color: '#007bff' },
                        onClick: () => setIsRegistering(!isRegistering)
                    }, isRegistering ? 'Already have an account? Sign In' : 'Need an account? Register')
                )
            );
        };

        const Dashboard = ({ user, onLogout }) => {
            const [message, setMessage] = useState('Testing backend connection...');

            useEffect(() => {
                fetch(`${API_BASE_URL}/health`)
                    .then(response => {
                        if (response.ok) {
                            setMessage('âœ… Backend connected successfully!');
                        } else {
                            setMessage('âš ï¸ Backend responded with error');
                        }
                    })
                    .catch(() => {
                        setMessage('âŒ Cannot connect to backend');
                    });
            }, []);

            return React.createElement('div', { className: 'dashboard' },
                React.createElement('div', { className: 'dashboard-header' },
                    React.createElement('h1', null, 'ðŸ¥ Healthcare Dashboard'),
                    React.createElement('div', { className: 'user-info' },
                        React.createElement('span', null, `Welcome, ${user.full_name || 'User'} (${user.role || 'Unknown'})`),
                        React.createElement('button', {
                            onClick: onLogout,
                            className: 'btn btn-secondary'
                        }, 'Logout')
                    )
                ),
                React.createElement('div', { className: 'card' },
                    React.createElement('h3', null, 'System Status'),
                    React.createElement('div', { 
                        className: message.includes('âœ…') ? 'success' : 'error'
                    }, message),
                    React.createElement('p', { style: { marginTop: '1rem' } }, `Role: ${user.role || 'Unknown'}`),
                    React.createElement('p', null, `Email: ${user.email || 'N/A'}`)
                )
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const token = localStorage.getItem('auth_token');
                const userData = localStorage.getItem('user');
                
                if (token && userData) {
                    try {
                        setUser(JSON.parse(userData));
                    } catch (e) {
                        localStorage.clear();
                    }
                }
                
                setLoading(false);
            }, []);

            const handleLogin = (userData) => setUser(userData);
            const handleLogout = () => {
                localStorage.clear();
                setUser(null);
            };

            if (loading) {
                return React.createElement('div', { className: 'loading-container' },
                    React.createElement('div', { className: 'loading-spinner' }),
                    React.createElement('p', null, 'Loading...')
                );
            }

            return user ? 
                React.createElement(Dashboard, { user, onLogout: handleLogout }) :
                React.createElement(LoginForm, { onLogin: handleLogin });
        };

        console.log('ðŸš€ Starting Healthcare System...');
        const container = document.getElementById('app');
        const root = createRoot(container);
        root.render(React.createElement(App));
        console.log('âœ… System ready!');
    </script>
</body>
</html>